<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>COSC300</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../style.css">
</head>
<body>

  <!-- Side Bar -->
  <div class="offcanvas offcanvas-start" data-bs-scroll="true" tabindex="-1" id="offcanvasWithBothOptions" aria-labelledby="offcanvasWithBothOptionsLabel">
      <div class="offcanvas-header">
          <h5 class="offcanvas-title" id="username" id="offcanvasWithBothOptionsLabel"></h5>
          <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body fixed-bottom">
        <button id="log-out-button" type="button" class="btn btn-danger">Log Out</button>
      </div>
  </div>

  <!-- Navigation Bar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand nav-head" data-bs-toggle="offcanvas" data-bs-target="#offcanvasWithBothOptions" aria-controls="offcanvasWithBothOptions">Museum AR</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item"><a class="nav-link active" href="#">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="#">Exhibits</a></li>
          <li class="nav-item"><a class="nav-link" href="#">About</a></li>
          <li class="nav-item"><a class="nav-link" href="#">Contact</a></li>
          <div class="buttons d-flex mt-2">
            <li><button id="settings-btn" class="btn btn-sm btn-light"><i class="bi bi-gear"></i> Settings</button></li>
            <li><button id="theme-toggle" class="btn btn-sm btn-light ms-1"><i class="bi bi-moon-fill"></i> Dark Mode</button></li>
          </div>
        </ul>
      </div>
    </div>
  </nav>

  <div id="settings-panel" class="container mt-3 d-none">
    <div class="card">
      <div class="card-header bg-light">
        <h5 class="mb-0">AR Settings</h5>
      </div>
      <div class="card-body">
        <form>
          <div class="mb-3">
            <label class="form-label">Language</label>
            <select class="form-select">
              <option>English</option>
              <option>Spanish</option>
              <option>French</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Text Size</label>
            <input type="range" class="form-range" min="12" max="24" step="2">
          </div>
          <div class="form-check form-switch mb-3">
            <input class="form-check-input" type="checkbox" id="audio-toggle">
            <label class="form-check-label" for="audio-toggle">Enable Audio Guides</label>
          </div>
          <button type="button" class="btn btn-sm btn-primary">Save</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Header and Search -->
  <div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h1 class="h3">Museum Artifacts</h1>
      <input id="search-bar" type="text" class="form-control w-50" placeholder="Search artifacts...">
    </div>

    <!-- Oviraptor QR Section -->
    <div class="card mb-4">
      <div class="card-header bg-primary text-white">
        <h5 class="mb-0">Oviraptor QR Code</h5>
      </div>
      <div class="card-body text-center">
        <img src="Oviraptor_QR.png" alt="Oviraptor QR Code" class="card-img-top">
        <p class="mt-2" id="oviraptor-desc">
          Oviraptor in Augmented Reality
          Encounter Oviraptor philoceratops, a small theropod dinosaur from the Late Cretaceous period, approximately 75 million years ago. Discovered in present-day Mongolia, this dinosaur was initially thought to be an egg thief, but later evidence suggests it may have been a caring parent. Through augmented reality, examine its unique beak structure, nesting behavior, and likely diet as it appears within your own environment. Rotate, scale, and observe the specimen to appreciate its significance in the tree of life.
        </p>
        <button id="text-2-speech" class="btn btn-secondary mt-2">Text-to-Speech</button>
      </div>
    </div>

    <script>
      document.getElementById('text-2-speech').addEventListener('click', async () => {
        const descElem = document.getElementById('oviraptor-desc');
        const originalDesc = descElem.textContent;

        try {
          // Call your backend TTS endpoint (which uses OAuth 2.0 credentials)
          const response = await fetch('http://localhost:3000/api/text-to-speech', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ text: originalDesc })
          });

          const data = await response.json();
          if (data.audioContent) {
            // Play the base64-encoded MP3 audio returned by the backend
            const audio = new Audio('data:audio/mp3;base64,' + data.audioContent);
            audio.play();
          } else {
            alert('Failed to synthesize speech: ' + (data.error || 'Unknown error.'));
          }
        } catch (err) {
          alert('Error connecting to AI server.');
        }
      });
    </script>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>
  <script src="../script.js"></script>
</body>
</html>